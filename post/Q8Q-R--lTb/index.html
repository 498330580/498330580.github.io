<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>ç»„ç½‘æœåŠ¡Netbird | ç‘¶ç²ä¹‹å®¶</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://blog.yaoling.cc/favicon.ico?v=1744077481223">
<link rel="stylesheet" href="https://blog.yaoling.cc/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ç®€ä»‹
NetBird æ˜¯ä¸€ä¸ªå¼€æºçš„ Zero Trust ç½‘ç»œå¹³å°ï¼Œå…è®¸æ‚¨ä¸ºæ‚¨çš„ ç»„ç»‡æˆ–å®¶åº­ã€‚æˆ‘ä»¬å°† NetBird è®¾è®¡ä¸ºç®€å•å¿«é€Ÿï¼Œå‡ ä¹ä¸éœ€è¦ä»»ä½•é…ç½®å·¥ä½œï¼Œå¹¶ä¸”åªéœ€ åœ¨æ‰“å¼€ç«¯å£çš„éº»çƒ¦ã€å¤æ‚çš„é˜²ç«å¢™è§„åˆ™ã€VPN ç½‘å…³ç­‰çš„èƒŒåã€‚


NetB..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://blog.yaoling.cc">
        <img src="https://blog.yaoling.cc/images/avatar.png?v=1744077481223" class="site-logo">
        <h1 class="site-title">ç‘¶ç²ä¹‹å®¶</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      ä¸€ä¸ªä¸ªäººè®°å½•ç½‘ç«™
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/498330580" target="_blank">498330580</a> | <a class="rss" href="https://blog.yaoling.cc/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">ç»„ç½‘æœåŠ¡Netbird</h2>
            <div class="post-date">2025-04-08</div>
            
            <div class="post-content" v-pre>
              <h1 id="ç®€ä»‹">ç®€ä»‹</h1>
<p>NetBird æ˜¯ä¸€ä¸ªå¼€æºçš„ Zero Trust ç½‘ç»œå¹³å°ï¼Œå…è®¸æ‚¨ä¸ºæ‚¨çš„ ç»„ç»‡æˆ–å®¶åº­ã€‚æˆ‘ä»¬å°† NetBird è®¾è®¡ä¸ºç®€å•å¿«é€Ÿï¼Œå‡ ä¹ä¸éœ€è¦ä»»ä½•é…ç½®å·¥ä½œï¼Œå¹¶ä¸”åªéœ€ åœ¨æ‰“å¼€ç«¯å£çš„éº»çƒ¦ã€å¤æ‚çš„é˜²ç«å¢™è§„åˆ™ã€VPN ç½‘å…³ç­‰çš„èƒŒåã€‚</p>
<!-- more -->
<blockquote>
<p>NetBird æ˜¯ä¸€ä¸ª**<a href="https://github.com/netbirdio/netbird">å¼€æº</a>**é¡¹ç›®ï¼Œå¯ä»¥è‡ªæ‰˜ç®¡ã€‚Â <a href="https://docs.netbird.io/selfhosted/self-hosted-vs-cloud-netbird">åœ¨æ­¤å¤„</a>æŸ¥çœ‹è‡ªæ‰˜ç®¡ç‰ˆæœ¬å’Œäº‘æ‰˜ç®¡ç‰ˆæœ¬ä¹‹é—´çš„æ¯”è¾ƒã€‚</p>
</blockquote>
<p>NetBird æ²¡æœ‰é›†ä¸­å¼ VPN æœåŠ¡å™¨ - æ‚¨çš„è®¡ç®—æœºã€è®¾å¤‡ã€æœºå™¨å’ŒæœåŠ¡å™¨ç›´æ¥é€šè¿‡å¿«é€ŸåŠ å¯†éš§é“ç›¸äº’è¿æ¥ã€‚ å®ƒåˆ›å»ºäº†ä¸€ä¸ªé«˜æ€§èƒ½çš„ç‚¹å¯¹ç‚¹Â <a href="https://www.wireguard.com/">WireGuardÂ®</a>Â è¦†ç›–ç½‘ç»œï¼Œåªéœ€å•å‡»å‡ ä¸‹å³å¯è¿æ¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„è®¡ç®—æœºã€‚<br>
ä½¿ç”¨ NetBird éƒ¨ç½²å®‰å…¨çš„ç‚¹å¯¹ç‚¹ VPN å®é™…ä¸Šåªéœ€ä¸åˆ° 5 åˆ†é’Ÿã€‚</p>
<p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://netbird.io/">NetBird - Open-Source Zero Trust Networking</a>  æ–‡æ¡£ï¼š<a href="https://docs.netbird.io/">Introduction to NetBird - NetBird Docs</a></p>
<h1 id="å®‰è£…å‰å‡†å¤‡">å®‰è£…å‰å‡†å¤‡</h1>
<h2 id="ä¸€-ç¯å¢ƒé…ç½®">ä¸€ã€ç¯å¢ƒé…ç½®</h2>
<p>æˆ‘ä»¬æ¨èæŒ‰ç…§ Docker å®˜æ–¹æ–‡æ¡£å®‰è£… Docker å’Œ Docker Composeï¼Œå› ä¸ºéƒ¨åˆ† Linux å‘è¡Œç‰ˆè½¯ä»¶ä»“åº“ä¸­çš„ Docker ç‰ˆæœ¬å¯èƒ½è¿‡æ—§ã€‚</p>
<p><a href="https://docs.docker.com/install/">Docker å®‰è£…æ–‡æ¡£</a><br>
<a href="https://docs.docker.com/compose/install/">Docker Compose å®‰è£…æ–‡æ¡£</a></p>
<h2 id="äºŒ-è¦æ±‚">äºŒã€è¦æ±‚</h2>
<p><strong>åŸºç¡€è®¾æ–½è¦æ±‚ï¼š</strong></p>
<ul>
<li>è‡³å°‘å…·æœ‰Â <strong>1 ä¸ª CPU</strong>Â å’ŒÂ <strong>2 GB</strong>Â å†…å­˜çš„ Linux VMã€‚</li>
<li>VM åº”åœ¨ TCP ç«¯å£Â <strong>80</strong>ã€<strong>443</strong>ã€<strong>33073</strong>ã€<strong>10000</strong>Â å’ŒÂ <strong>33080</strong>Â ä¸Šå…¬å¼€è®¿é—®;å’Œ UDP ç«¯å£ï¼š<strong>3478</strong>ã€<strong>49152-65535</strong>ã€‚</li>
<li>æŒ‡å‘ VM çš„<strong>å…¬å…±åŸŸå</strong>ã€‚</li>
</ul>
<p><strong>è½¯ä»¶è¦æ±‚ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ docker compose æ’ä»¶ï¼ˆ<a href="https://docs.docker.com/engine/install/">Docker å®‰è£…æŒ‡å—</a>ï¼‰å®‰è£…åœ¨ VM ä¸Šçš„ Dockerï¼Œæˆ–ä½¿ç”¨ç‰ˆæœ¬ 2 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ docker-compose å®‰è£…åœ¨ VM ä¸Šçš„ Dockerã€‚</li>
<li><a href="https://jqlang.github.io/jq/">JQ</a>Â å·²å®‰è£…ã€‚åœ¨å¤§å¤šæ•°å‘è¡Œç‰ˆä¸­ é€šå¸¸ä½äºå®˜æ–¹ä»“åº“ä¸­ï¼Œæ ¹æ®ç³»ç»Ÿæ‰§è¡Œ<code>sudo apt install jq</code>æˆ–<code>sudo yum install jq</code>å®‰è£…</li>
<li><a href="https://curl.se/">curl</a>Â å·²å®‰è£…ã€‚ é€šå¸¸ä½äºå®˜æ–¹ä»“åº“ä¸­ï¼Œæ ¹æ®ç³»ç»Ÿæ‰§è¡Œ<code>sudo apt install curl</code>æˆ–<code>sudo yum install curl</code>å®‰è£…</li>
</ul>
<h2 id="ä¸‰-åˆ›å»ºå®‰è£…ç›®å½•">ä¸‰ã€åˆ›å»ºå®‰è£…ç›®å½•</h2>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-shell">cd ~
mkdir netbird &amp;&amp; cd netbird
</code></pre>
<h1 id="å¿«é€Ÿå®‰è£…">å¿«é€Ÿå®‰è£…</h1>
<blockquote>
<p>é€‚ç”¨äºæœ¬æœºæ²¡æœ‰å ç”¨80ã€443ç«¯å£çš„æœåŠ¡å™¨ï¼Œå¦‚æœè‡ªå·±é…ç½®æœ‰åå‘ä»£ç†æœåŠ¡ï¼Œè¯·ä½¿ç”¨è‡ªå®šä¹‰å®‰è£…æœåŠ¡</p>
</blockquote>
<h2 id="ä¸€-ä¸‹è½½å¹¶è¿è¡Œè„šæœ¬">ä¸€ã€ä¸‹è½½å¹¶è¿è¡Œè„šæœ¬</h2>
<p>ä¸‹è½½å¹¶è¿è¡Œå®‰è£…è„šæœ¬ï¼Œåªéœ€ä¸€è¡Œï¼š</p>
<pre><code class="language-bash">export NETBIRD_DOMAIN=netbird.example.com; curl -fsSL https://github.com/netbirdio/netbird/releases/latest/download/getting-started-with-zitadel.sh | bash
</code></pre>
<p>å¦‚æœæ‚¨æƒ³åœ¨è¿è¡Œè„šæœ¬ä¹‹å‰æ£€æŸ¥è„šæœ¬ï¼Œæ‚¨å¯ä»¥ä¸‹è½½å®ƒå¹¶åœ¨æœ¬åœ°è¿è¡Œå®ƒï¼š</p>
<pre><code class="language-bash">curl -sSLO https://github.com/netbirdio/netbird/releases/latest/download/getting-started-with-zitadel.sh
# check the script
cat getting-started-with-zitadel.sh
# run the script
export NETBIRD_DOMAIN=netbird.example.com
bash getting-started-with-zitadel.sh
</code></pre>
<p>æ›¿æ¢ä¸ºæ‚¨çš„åŸŸåã€‚<code>netbird.example.com</code></p>
<p>è„šæœ¬æ‰§è¡Œå®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„å‡­æ®é€šè¿‡ URL è®¿é—®æ‚¨çš„ netbird å®ä¾‹ã€‚<code>https://netbird.example.com</code></p>
<h2 id="äºŒ-æ·»åŠ ç”¨æˆ·">äºŒã€æ·»åŠ ç”¨æˆ·</h2>
<p>å¦‚æœè¦æ·»åŠ å…¶ä»–ç”¨æˆ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å‡­æ®é€šè¿‡ URL è®¿é—® Zitadel çš„ç®¡ç†æ§åˆ¶å°ã€‚æŒ‰ç…§ Zitadel çš„<a href="https://zitadel.com/docs/guides/manage/console/users">ç”¨æˆ·æŒ‡å—</a>æ·»åŠ å…¶ä»–æœ¬åœ°ç”¨æˆ·ï¼Œæˆ–æŒ‰ç…§<a href="https://zitadel.com/docs/guides/integrate/identity-providers">æŒ‡å—é…ç½®èº«ä»½æä¾›å•†</a>å°† Zitadel ä¸æ‚¨ç°æœ‰çš„èº«ä»½æä¾›å•†é›†æˆã€‚<code>https://netbird.example.com/ui/console</code></p>
<h2 id="ä¸‰-å¤‡ä»½">ä¸‰ã€å¤‡ä»½</h2>
<p>è¦å¤‡ä»½ NetBird å®‰è£…ï¼Œæ‚¨éœ€è¦å¤åˆ¶é…ç½®æ–‡ä»¶ã€ç®¡ç†æœåŠ¡æ•°æ®åº“å’Œ Zitadel çš„æ•°æ®åº“ã€‚<br>
é…ç½®æ–‡ä»¶ä½äºè¿è¡Œå®‰è£…è„šæœ¬çš„æ–‡ä»¶å¤¹ä¸­ã€‚è¦å¤‡ä»½ï¼Œè¯·å°†æ–‡ä»¶å¤åˆ¶åˆ°å¤‡ä»½ä½ç½®ï¼š</p>
<pre><code class="language-bash">mkdir backup
cp docker-compose.yml Caddyfile zitadel.env dashboard.env turnserver.conf management.json relay.env zdb.env backup/
</code></pre>
<p>è¦ä¿å­˜ç®¡ç†æœåŠ¡æ•°æ®åº“ï¼Œæ‚¨éœ€è¦åœæ­¢ç®¡ç†æœåŠ¡å¹¶ä½¿ç”¨ docker compose å‘½ä»¤ä»å­˜å‚¨ç›®å½•ä¸­å¤åˆ¶æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-bash">docker compose stop management
docker compose cp -a management:/var/lib/netbird/ backup/
docker compose start management
</code></pre>
<p>æ‚¨å¯ä»¥æŒ‰ç…§Â <a href="https://www.cockroachlabs.com/docs/stable/backup">Cockroach å¤‡ä»½æŒ‡å—</a>å¤‡ä»½ Zitadel çš„æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<h2 id="å››-å‡çº§">å››ã€å‡çº§</h2>
<p>ä½¿ç”¨ç‰ˆæœ¬ &lt;Â <a href="https://github.com/netbirdio/netbird/releases/tag/v0.15.3">v0.15.3</a>Â çš„ç”¨æˆ·åº”é¦–å…ˆå°†ä»–ä»¬çš„ç³»ç»Ÿå‡çº§åˆ°Â <a href="https://github.com/netbirdio/netbird/releases/tag/v0.25.9">v0.25.9</a>ã€‚ è¿è¡Œ Management ä»¥å°†è§„åˆ™æ­£ç¡®è¿ç§»åˆ°ç­–ç•¥ï¼Œç„¶åå‡çº§åˆ°Â <strong>0.26.0+</strong>ã€‚<br>
è¦å°† NetBird å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œæ‚¨éœ€è¦æŸ¥çœ‹<a href="https://github.com/netbirdio/netbird/releases">å‘è¡Œè¯´æ˜</a>ä»¥äº†è§£ä»»ä½•é‡å¤§æ›´æ”¹ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹å‡çº§æ­¥éª¤ä½œï¼š</p>
<ol>
<li>
<p>è¿è¡ŒÂ <a href="https://docs.netbird.io/selfhosted/selfhosted-quickstart#backup">backup</a>Â éƒ¨åˆ†ä¸­æè¿°çš„å¤‡ä»½æ­¥éª¤ã€‚</p>
</li>
<li>
<p>æ‹‰å–æœ€æ–°çš„ NetBird docker é•œåƒï¼š</p>
<pre><code class="language-bash">docker compose pull management dashboard signal relay
</code></pre>
</li>
<li>
<p>ä½¿ç”¨æ–°æ˜ åƒé‡æ–°å¯åŠ¨ NetBird å®¹å™¨ï¼š</p>
<pre><code class="language-bash">docker compose up -d --force-recreate management dashboard signal relay
</code></pre>
</li>
</ol>
<h2 id="äº”-åˆ é™¤">äº”ã€åˆ é™¤</h2>
<p>è¦ä»æœåŠ¡å™¨ä¸­åˆ é™¤ NetBird å®‰è£…å’Œæ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œè¯·ä»å®‰è£… NetBird çš„æ–‡ä»¶å¤¹ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-bash"># remove all NetBird-related containers and volumes (data)
docker compose down --volumes
# remove downloaded and generated config files
rm -f docker-compose.yml Caddyfile zitadel.env dashboard.env machinekey/zitadel-admin-sa.token turnserver.conf management.json
</code></pre>
<h1 id="è‡ªå®šä¹‰å®‰è£…">è‡ªå®šä¹‰å®‰è£…</h1>
<h2 id="ä¸€-éƒ¨ç½²authentik-idp">ä¸€ã€éƒ¨ç½²Authentik IDP</h2>
<blockquote>
<p>NetBird æ”¯æŒé€šç”¨ OpenID ï¼ˆOIDCï¼‰ åè®®ï¼Œå…è®¸ä¸éµå¾ªè§„èŒƒçš„ä»»ä½• IDP é›†æˆã€‚<br>
NetBird çš„ç®¡ç†æœåŠ¡ä¸ä¸€äº›æœ€æµè¡Œçš„ IDP API é›†æˆï¼Œå…è®¸è¯¥æœåŠ¡ç¼“å­˜å’Œæ˜¾ç¤ºç”¨æˆ·åå’Œç”µå­é‚®ä»¶åœ°å€ï¼Œè€Œæ— éœ€å­˜å‚¨æ•æ„Ÿæ•°æ®ã€‚</p>
</blockquote>
<h3 id="1-æ–°å»ºç›®å½•å¹¶ä¸‹è½½å®˜æ–¹çš„docker-compose">1. æ–°å»ºç›®å½•ï¼Œå¹¶ä¸‹è½½å®˜æ–¹çš„docker-compose</h3>
<pre><code class="language-shell">cd ~ &amp;&amp; mkdir authentik &amp;&amp; cd authentik &amp;&amp; wget https://goauthentik.io/docker-compose.yml
</code></pre>
<h3 id="2-å®‰è£…ä¸€ä¸ªç”Ÿæˆéšæœºå¯†ç çš„å°å·¥å…·">2. å®‰è£…ä¸€ä¸ªç”Ÿæˆéšæœºå¯†ç çš„å°å·¥å…·</h3>
<pre><code class="language-shell">apt -y install pwgen
</code></pre>
<h3 id="3-ç”Ÿæˆå¯†ç å’Œå¯†åŒ™åˆ°envæ–‡ä»¶">3. ç”Ÿæˆå¯†ç å’Œå¯†åŒ™åˆ°.envæ–‡ä»¶</h3>
<pre><code class="language-shell">echo &quot;PG_PASS=$(pwgen -s 40 1)&quot; &gt;&gt; .env
echo &quot;AUTHENTIK_SECRET_KEY=$(pwgen -s 50 1)&quot; &gt;&gt; .env
</code></pre>
<h3 id="4-å¯åŠ¨æœåŠ¡">4. å¯åŠ¨æœåŠ¡</h3>
<pre><code class="language-shell">docker compose up -d
</code></pre>
<h3 id="5-åå‘ä»£ç†æœåŠ¡">5. åå‘ä»£ç†æœåŠ¡</h3>
<h4 id="1-å…ˆåœ¨åŸŸåæœåŠ¡å•†é…ç½®ä½ è¦ä»£ç†çš„åŸŸådnsåˆ°ä½ çš„æœåŠ¡å™¨">(1) å…ˆåœ¨åŸŸåæœåŠ¡å•†é…ç½®ä½ è¦ä»£ç†çš„åŸŸåDNSåˆ°ä½ çš„æœåŠ¡å™¨</h4>
<h4 id="2-é…ç½®åå‘ä»£ç†æœåŠ¡">(2) é…ç½®åå‘ä»£ç†æœåŠ¡</h4>
<blockquote>
<p>æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯NPMï¼ŒNPMçš„å®‰è£…å‚è€ƒæˆ‘å¦ä¸€ç¯‡æ•™ç¨‹ <a href="Nginx%20Proxy%20Manager%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85.md">Nginx Proxy Manageråå‘ä»£ç†å·¥å…·å®‰è£…</a></p>
</blockquote>
<p><strong>ç”±äºå®˜æ–¹çš„docker-composeæ˜¯å¯¹å¤–æœåŠ¡çš„ç«¯å£æ˜¯<code>9000(http)</code>å’Œ<code>9443(https)</code>æˆ‘ä»¬åœ¨ä»£ç†çš„æ—¶å€™å°±æ˜¯ä»£ç†è¿™ä¸¤ä¸ªç«¯å£ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ç»™æœåŠ¡é…ç½®sslè¯ä¹¦ï¼Œé‚£å°±æ˜¯ç›´æ¥å¸¦äº†<code>9000</code>ç«¯å£</strong></p>
<figure data-type="image" tabindex="1"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743561740339-PixPin_2025-04-02_10-38-15.png" alt="PixPin_2025-04-02_10-38-15.png" loading="lazy"></figure>
<figure data-type="image" tabindex="2"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743561745757-PixPin_2025-04-02_10-39-11.png" alt="PixPin_2025-04-02_10-39-11.png" loading="lazy"></figure>
<figure data-type="image" tabindex="3"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743561755593-PixPin_2025-04-02_10-40-09.png" alt="PixPin_2025-04-02_10-40-09.png" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743561759743-PixPin_2025-04-02_10-41-21.png" alt="PixPin_2025-04-02_10-41-21.png" loading="lazy"></figure>
<h4 id="3-é…ç½®authentik-idp">(3) é…ç½®Authentik IDP</h4>
<p><strong>ğŸ‘‰ å…ˆè®¿é—®ï¼šhttps://ä½ çš„åŸŸå/if/flow/initial-setup/ï¼Œé…ç½®é»˜è®¤çš„ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ã€‚</strong></p>
<p><strong>ğŸ‘‰ æŒ‰ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œé…ç½®ï¼š<a href="https://docs.netbird.io/selfhosted/identity-providers#authentik">èº«ä»½æä¾›å•† - NetBird Docs</a>ï¼Œè¿™é‡Œæˆ‘å°±ä¸é‡å¤è¿™äº›æ­¥éª¤äº†ã€‚åŠ¡å¿…è®°ä¸‹Client IDã€Usernameã€Passwordï¼Œåç»­é…ç½®Netbirdéœ€è¦ç”¨åˆ°ã€‚</strong></p>
<p><strong>â—ï¸ å¦‚æœä½ å®Œå…¨æŒ‰ç…§å®˜æ–¹çš„æ–‡æ¡£é…ç½®ï¼Œé‚£ä¹ˆUsernameå°±æ˜¯ï¼šNetbirdï¼ˆæ³¨æ„å¤§å°å†™ï¼‰</strong><br>
<strong>â—ï¸ Passwordæ˜¯æœåŠ¡è´¦æˆ·çš„å¯†ç ï¼Œä¸æ˜¯Authentikç®¡ç†å‘˜è´¦æˆ·çš„å¯†ç ã€‚</strong></p>
<h5 id="ç¬¬-1-æ­¥åˆ›å»º-oauth2openid-æä¾›è€…">ç¬¬ 1 æ­¥ï¼šåˆ›å»º OAuth2/OpenID æä¾›è€…</h5>
<figure data-type="image" tabindex="5"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563789766-PixPin_2025-04-02_10-57-20.png" alt="PixPin_2025-04-02_10-57-20.png" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563797363-PixPin_2025-04-02_10-58-00.png" alt="PixPin_2025-04-02_10-58-00.png" loading="lazy"></figure>
<figure data-type="image" tabindex="7"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563804869-PixPin_2025-04-02_11-01-13.png" alt="PixPin_2025-04-02_11-01-13.png" loading="lazy"></figure>
<figure data-type="image" tabindex="8"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563815513-PixPin_2025-04-02_11-07-59.png" alt="PixPin_2025-04-02_11-07-59.png" loading="lazy"></figure>
<figure data-type="image" tabindex="9"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563836393-PixPin_2025-04-02_11-14-59.png" alt="PixPin_2025-04-02_11-14-59.png" loading="lazy"></figure>
<figure data-type="image" tabindex="10"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563849014-PixPin_2025-04-02_11-09-01.png" alt="PixPin_2025-04-02_11-09-01.png" loading="lazy"></figure>
<figure data-type="image" tabindex="11"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563855904-PixPin_2025-04-02_11-10-54.png" alt="PixPin_2025-04-02_11-10-54.png" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743563864851-PixPin_2025-04-02_11-11-35.png" alt="PixPin_2025-04-02_11-11-35.png" loading="lazy"></figure>
<h5 id="æ­¥éª¤-2åˆ›å»ºå¤–éƒ¨åº”ç”¨ç¨‹åº">æ­¥éª¤ 2ï¼šåˆ›å»ºå¤–éƒ¨åº”ç”¨ç¨‹åº</h5>
<figure data-type="image" tabindex="13"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743564107426-PixPin_2025-04-02_11-18-55.png" alt="PixPin_2025-04-02_11-18-55.png" loading="lazy"></figure>
<figure data-type="image" tabindex="14"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743564115807-PixPin_2025-04-02_11-21-28.png" alt="PixPin_2025-04-02_11-21-28.png" loading="lazy"></figure>
<h5 id="ç¬¬-3-æ­¥åˆ›å»ºæœåŠ¡å¸æˆ·">ç¬¬ 3 æ­¥ï¼šåˆ›å»ºæœåŠ¡å¸æˆ·</h5>
<figure data-type="image" tabindex="15"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743566985962-PixPin_2025-04-02_11-26-20.png" alt="PixPin_2025-04-02_11-26-20.png" loading="lazy"></figure>
<figure data-type="image" tabindex="16"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743566995127-PixPin_2025-04-02_11-30-22.png" alt="PixPin_2025-04-02_11-30-22.png" loading="lazy"></figure>
<figure data-type="image" tabindex="17"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743567001362-PixPin_2025-04-02_11-39-40.png" alt="PixPin_2025-04-02_11-39-40.png" loading="lazy"></figure>
<h5 id="ç¬¬-4-æ­¥å°†æœåŠ¡è´¦æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„">ç¬¬ 4 æ­¥ï¼šå°†æœåŠ¡è´¦æˆ·æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„</h5>
<figure data-type="image" tabindex="18"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743583472333-PixPin_2025-04-02_16-40-41.png" alt="PixPin_2025-04-02_16-40-41.png" loading="lazy"></figure>
<figure data-type="image" tabindex="19"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743583493386-PixPin_2025-04-02_16-41-51.png" alt="PixPin_2025-04-02_16-41-51.png" loading="lazy"></figure>
<figure data-type="image" tabindex="20"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743583506550-PixPin_2025-04-02_16-42-34.png" alt="PixPin_2025-04-02_16-42-34.png" loading="lazy"></figure>
<h5 id="ç¬¬-5-æ­¥åˆ›å»ºç”¨äºè®¾å¤‡ä»¤ç‰Œèº«ä»½éªŒè¯çš„èº«ä»½éªŒè¯æµç¨‹">ç¬¬ 5 æ­¥ï¼šåˆ›å»ºç”¨äºè®¾å¤‡ä»¤ç‰Œèº«ä»½éªŒè¯çš„èº«ä»½éªŒè¯æµç¨‹</h5>
<figure data-type="image" tabindex="21"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743584162245-PixPin_2025-04-02_16-46-37.png" alt="PixPin_2025-04-02_16-46-37.png" loading="lazy"></figure>
<figure data-type="image" tabindex="22"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743584174577-PixPin_2025-04-02_16-50-27.png" alt="PixPin_2025-04-02_16-50-27.png" loading="lazy"></figure>
<p>ç„¶åå›åˆ°èœå•é€‰æ‹©</p>
<figure data-type="image" tabindex="23"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743584235159-PixPin_2025-04-02_16-51-30.png" alt="PixPin_2025-04-02_16-51-30.png" loading="lazy"></figure>
<figure data-type="image" tabindex="24"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743584289982-PixPin_2025-04-02_16-53-02.png" alt="PixPin_2025-04-02_16-53-02.png" loading="lazy"></figure>
<figure data-type="image" tabindex="25"><img src="https://r2-oss.yaoling.cc/image/2025/04/02/piclist-1743584299303-PixPin_2025-04-02_16-54-24.png" alt="PixPin_2025-04-02_16-54-24.png" loading="lazy"></figure>
<p><strong>åŠ¡å¿…åšå¥½ä¸Šè¿°è¿™äº›é…ç½®ï¼Œå¦åˆ™åç»­Netbirdå®¢æˆ·ç«¯å°†æ— æ³•é€šè¿‡URLçš„æ–¹å¼é‰´æƒã€‚</strong></p>
<h2 id="äºŒ-å®‰è£…netbird">äºŒã€å®‰è£…netbird</h2>
<h3 id="1åˆ›å»ºæ‹‰å–è„šæœ¬å¹¶æ‹‰å–æœ€æ–°ä»£ç ">1.åˆ›å»ºæ‹‰å–è„šæœ¬ï¼Œå¹¶æ‹‰å–æœ€æ–°ä»£ç </h3>
<h4 id="ç¬¬ä¸€æ­¥-å…ˆåˆ›å»ºnetbirdç›®å½•">ç¬¬ä¸€æ­¥ã€å…ˆåˆ›å»º<code>netbird</code>ç›®å½•</h4>
<pre><code class="language-shell">cd ~ &amp;&amp; mkdir netbird &amp;&amp; cd netbird
</code></pre>
<h4 id="ç¬¬äºŒæ­¥-æ‰§è¡Œnano-startshç„¶åè¾“å…¥ä»¥ä¸‹å†…å®¹">ç¬¬äºŒæ­¥ã€æ‰§è¡Œ<code>nano start.sh</code>ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</h4>
<pre><code class="language-bash">#!/bin/bash
REPO=&quot;https://github.com/netbirdio/netbird/&quot;
# this command will fetch the latest release e.g. v0.8.7
LATEST_TAG=$(basename $(curl -fs -o/dev/null -w %{redirect_url} ${REPO}releases/latest))
echo $LATEST_TAG

# this command will clone the latest tag
git clone --depth 1 --branch $LATEST_TAG $REPO
</code></pre>
<p>æŒ‰<code>Ctrl+X</code>è¾“å…¥<code>y</code>æœ€åå›è½¦ä¿å­˜<code>start.sh</code>æ–‡ä»¶</p>
<p>æ‰§è¡Œ<code>chmod +x start.sh</code>èµ‹äºˆæ–‡ä»¶æ‰§è¡Œæƒé™ï¼Œä¹‹åè¿è¡Œ<code>start.sh</code>è„šæœ¬ä»¥è·å–æœ€æ–°ç‰ˆæœ¬å¹¶å…‹éš†ä»£ç </p>
<h3 id="2-é…ç½®netbird">2. é…ç½®netbird</h3>
<h4 id="æ­¥éª¤1è¿›å…¥é…ç½®ç›®å½•">æ­¥éª¤1ï¼šè¿›å…¥é…ç½®ç›®å½•</h4>
<pre><code class="language-shell">cd netbird/infrastructure_files/
</code></pre>
<h4 id="æ­¥éª¤2å‡†å¤‡é…ç½®æ–‡ä»¶">æ­¥éª¤2ï¼šå‡†å¤‡é…ç½®æ–‡ä»¶</h4>
<pre><code class="language-shell"># å¤åˆ¶é…ç½®æ¨¡æ¿
cp setup.env.example setup.env
# ç¼–è¾‘é…ç½®
nano setup.env
</code></pre>
<p><strong>éœ€è¦ä¿®æ”¹çš„å†…å®¹å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="language-env"># è¿™é‡Œå¡«å†™ä½ çš„netbirdåŸŸå
NETBIRD_DOMAIN=&quot;&quot;


# è¿™é‡Œå¡«å†™ä½ çš„authentikè®¤è¯æœåŠ¡çš„åœ°å€ &quot;https://ä½ çš„æœåŠ¡åŸŸå/application/o/netbird/.well-known/openid-configuration&quot;
NETBIRD_AUTH_OIDC_CONFIGURATION_ENDPOINT=&quot;https://ä½ çš„æœåŠ¡åŸŸå/application/o/netbird/.well-known/openid-configuration&quot;

# è¿™é‡Œå¡«å†™ä½ çš„authentikå¾—åˆ°çš„å®¢æˆ·ç«¯ID
NETBIRD_AUTH_AUDIENCE=&quot;&quot;
NETBIRD_AUTH_CLIENT_ID=&quot;&quot;
NETBIRD_AUTH_DEVICE_AUTH_CLIENT_ID=&quot;&quot;
NETBIRD_AUTH_DEVICE_AUTH_AUDIENCE=&quot;&quot;
NETBIRD_IDP_MGMT_CLIENT_ID=&quot;&quot;

# è¿™ä¸€é¡¹è¿™æ ·ä¿®æ”¹
NETBIRD_AUTH_SUPPORTED_SCOPES=&quot;openid profile email offline_access api&quot;

# è¿™é‡Œå¡«å†™authentik
NETBIRD_MGMT_IDP=&quot;authentik&quot;

# ä¿®æ”¹è¿™é‡Œçš„ä¸ºtrue
NETBIRD_DISABLE_LETSENCRYPT=true

# æ·»åŠ å¦‚ä¸‹å†…å®¹
# è¿™ä¸ªç›´æ¥å¡«å†™Netbird
NETBIRD_IDP_MGMT_EXTRA_USERNAME=&quot;Netbird&quot;
# è¿™é‡Œå¡«å†™ä½ ä¹‹å‰é…ç½®Authentikæ—¶å¾—åˆ°çš„æœåŠ¡è´¦æˆ·å¯†ç 
NETBIRD_IDP_MGMT_EXTRA_PASSWORD=&quot;Service Account Password&quot;

# ä¿®æ”¹é»˜è®¤ç«¯å£
NETBIRD_MGMT_API_PORT=8012
NETBIRD_SIGNAL_PORT=10000

</code></pre>
<p><strong>å‚è€ƒçš„æ˜¯å¦‚ä¸‹å›¾è¿™ä¸ª<a href="https://docs.netbird.io/selfhosted/identity-providers#authentik">å®˜æ–¹æ–‡æ¡£</a>ï¼š</strong></p>
<figure data-type="image" tabindex="26"><img src="https://r2-oss.yaoling.cc/image/2025/04/03/piclist-1743678611132-PixPin_2025-04-03_19-07-38.png" alt="PixPin_2025-04-03_19-07-38.png" loading="lazy"></figure>
<p><strong>ä¿®æ”¹å®Œæˆåè®°å¾—<code>ctrl+x</code> ç„¶åè¾“å…¥<code>y</code> æœ€åå›è½¦ä¿å­˜</strong></p>
<h4 id="æ­¥éª¤3å¯é€‰ç¦ç”¨å•è´¦æˆ·æ¨¡å¼">æ­¥éª¤3ï¼ˆå¯é€‰)ï¼šç¦ç”¨å•è´¦æˆ·æ¨¡å¼</h4>
<p><strong>ä¿®æ”¹<code>docker-compose.yml.tmpl</code>æ–‡ä»¶</strong></p>
<pre><code class="language-shell">nano docker-compose.yml.tmpl
</code></pre>
<p><strong>ç„¶ååœ¨<code>management</code>ä¸­æ·»åŠ <code>--disable-single-account-mode</code>è¿™æ¡å¯åŠ¨å‘½ä»¤</strong></p>
<figure data-type="image" tabindex="27"><img src="https://r2-oss.yaoling.cc/image/2025/04/03/piclist-1743679898341-PixPin_2025-04-03_19-29-33.png" alt="PixPin_2025-04-03_19-29-33.png" loading="lazy"></figure>
<p><strong>æœ€åä¿å­˜å¹¶é€€å‡º</strong></p>
<h4 id="æ­¥éª¤4ç”Ÿæˆé…ç½®æ–‡ä»¶">æ­¥éª¤4ï¼šç”Ÿæˆé…ç½®æ–‡ä»¶</h4>
<p><strong>æ‰§è¡Œå®˜æ–¹æä¾›çš„é…ç½®è„šæœ¬æ¥ç”Ÿæˆç›¸åº”çš„é…ç½®æ–‡ä»¶ï¼š</strong></p>
<pre><code class="language-shell">./configure.sh
</code></pre>
<h4 id="æ­¥éª¤5è¿è¡Œdocker-compose">æ­¥éª¤5ï¼šè¿è¡Œdocker compose</h4>
<p><strong>å®Œæˆåè½¬åˆ°artifactsç›®å½•</strong></p>
<pre><code class="language-shell">cd artifacts
</code></pre>
<p><em>é‡Œé¢åº”è¯¥æœ‰è¿™4ä¸ªæ–‡ä»¶ï¼šdocker-compose.ymlã€management.jsonã€openid-configuration.jsonã€turnserver.conf</em></p>
<p><strong>ğŸ‘‰ç”±äºå®˜æ–¹çš„è¿™ä¸ªè„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ä¸€äº›é…ç½®æ‰èƒ½ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œé¦–å…ˆç¼–è¾‘management.jsonï¼š</strong></p>
<pre><code class="language-shell">nano management.json
</code></pre>
<p>é»˜è®¤çš„ä¿¡å·æœåŠ¡çš„ç«¯å£ä¸º10000ï¼š</p>
<pre><code class="language-json">&quot;Signal&quot;: {
        &quot;Proto&quot;: &quot;https&quot;,
        &quot;URI&quot;: &quot;nb.example.com:10000&quot;,
        &quot;Username&quot;: &quot;&quot;,
        &quot;Password&quot;: &quot;&quot;
    },
</code></pre>
<p>éœ€è¦å°†å…¶æ”¹ä¸º443ç«¯å£ï¼Œå› ä¸ºæˆ‘ä»¬åç»­ä¼šé…ç½®ä½¿ç”¨Nginxåå‘ä»£ç†ä¿¡å·æœåŠ¡ï¼š</p>
<pre><code class="language-shell">&quot;Signal&quot;: {
        &quot;Proto&quot;: &quot;https&quot;,
        &quot;URI&quot;: &quot;nb.example.com:443&quot;,
        &quot;Username&quot;: &quot;&quot;,
        &quot;Password&quot;: &quot;&quot;
    },
</code></pre>
<p><strong>ğŸ‘‰è¿˜éœ€è¦ä¿®æ”¹composeæ–‡ä»¶ï¼š</strong></p>
<pre><code class="language-shell">nano docker-compose.yml
</code></pre>
<p>å®˜æ–¹çš„è„šæœ¬æ²¡æœ‰å¸®æˆ‘ä»¬å¤„ç†dashboardå®¹å™¨çš„ç«¯å£ï¼Œç”±äºæˆ‘ä»¬åç»­ä¼šé…ç½®ä½¿ç”¨Nginxåå‘ä»£ç†ï¼Œæ‰€ä»¥å°†è¿™é‡Œçš„443ç«¯å£æ³¨é‡Šæ‰ï¼Œå®¹å™¨å¤–çš„80ç«¯å£æ”¹ä¸º8011ï¼š</p>
<pre><code class="language-yaml">services:
  #UI dashboard
  dashboard:
    image: netbirdio/dashboard:latest
    restart: unless-stopped
    ports:
      - 8011:80
#      - 443:443
</code></pre>
<p><strong>ğŸ‘‰å¦å¤–dashboardå®¹å™¨çš„ç¯å¢ƒå˜é‡ä¹Ÿéœ€è¦åšä¿®æ”¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæŠŠEndpointsç›¸å…³çš„ç¯å¢ƒå˜é‡é…ç½®ä¸ºDomain:8012çš„å½¢å¼ï¼š</strong></p>
<pre><code class="language-yaml">services:
  #UI dashboard
  dashboard:
    image: netbirdio/dashboard:latest
    ...
    environment:
      # Endpoints
      - NETBIRD_MGMT_API_ENDPOINT=https://nb.example.com:8012
      - NETBIRD_MGMT_GRPC_API_ENDPOINT=https://nb.example.com:8012
    ...
</code></pre>
<p>éœ€è¦å°†å…¶ä¿®æ”¹ä¸ºï¼š</p>
<pre><code class="language-yaml">services:
  #UI dashboard
  dashboard:
    image: netbirdio/dashboard:latest
    ...
    environment:
      # Endpoints
      - NETBIRD_MGMT_API_ENDPOINT=https://nb.example.com
      - NETBIRD_MGMT_GRPC_API_ENDPOINT=https://nb.example.com
</code></pre>
<p><strong>ğŸ‘‰å¯ç”¨signalå®¹å™¨çš„æ—¥å¿—ï¼Œæ–¹ä¾¿åç»­ç»´æŠ¤å’Œè°ƒè¯•</strong></p>
<pre><code class="language-yaml">...
  signal:
    image: netbirdio/signal:latest
    restart: unless-stopped
...
    command: [ &quot;--log-file&quot;, &quot;console&quot;]
</code></pre>
<p><strong>ğŸ‘‰æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯åŠ¨å®¹å™¨</strong></p>
<pre><code class="language-shell">docker compose up -d
</code></pre>
<h4 id="æ­¥éª¤6é…ç½®nginxåå‘ä»£ç†netbird">æ­¥éª¤6ï¼šé…ç½®Nginxåå‘ä»£ç†Netbird</h4>
<p><strong>å¯åŠ¨NetbirdæˆåŠŸåï¼Œç°åœ¨éœ€è¦åä»£Netbirdçš„8011ã€8012ã€10000ç«¯å£ï¼ŒNginxç«™ç‚¹é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</strong></p>
<pre><code class="language-conf">upstream dashboard {
    server 127.0.0.1:8011;
    keepalive 10;
}
upstream signal {
    server 127.0.0.1:10000;
}
upstream management {
    server 127.0.0.1:8012;
}

server {
    listen 80;
    listen [::]:80;
    server_name nb.example.com;

    client_header_timeout 1d;
    client_body_timeout 1d;

    proxy_set_header        X-Real-IP $remote_addr;
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        X-Scheme $scheme;
    proxy_set_header        X-Forwarded-Proto https;
    proxy_set_header        X-Forwarded-Host $host;
    grpc_set_header         X-Forwarded-For $proxy_add_x_forwarded_for;

    # Proxy dashboard
    location / {
        proxy_pass http://dashboard;
    }
    # Proxy Signal
    location /signalexchange.SignalExchange/ {
        grpc_pass grpc://signal;
        #grpc_ssl_verify off;
        grpc_read_timeout 1d;
        grpc_send_timeout 1d;
        grpc_socket_keepalive on;
    }
    # Proxy Management http endpoint
    location /api {
        proxy_pass http://management;
    }
    # Proxy Management grpc endpoint
    location /management.ManagementService/ {
        grpc_pass grpc://management;
        #grpc_ssl_verify off;
        grpc_read_timeout 1d;
        grpc_send_timeout 1d;
        grpc_socket_keepalive on;
    }
}
</code></pre>
<p><strong>æŒ‰ç…§æ–‡ä»¶é…ç½®åå‘ä»£ç†ï¼Œç„¶åNetbirdæœåŠ¡ç«¯å°±å…¨éƒ¨éƒ¨ç½²å®Œæ¯•äº†ã€‚</strong></p>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://blog.yaoling.cc/post/Q7q_1R-Aui/">
                  <h3 class="post-title">
                    Nginx Proxy Manageråå‘ä»£ç†å·¥å…·å®‰è£…
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
